# Проектная работа "Веб-ларек"

## Описание проекта

Проект разработан с использованием TypeScript и представляет собой SPA (Single Page Application) с использованием API для получения данных о продуктах и совершения заказа.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Особенности реализации
Добавить в корзину и совершить покупку одного и того же продукта дважды нельзя, только один раз.

## Описание UX интерфейса

Интерфейс можно условно разделить на 3 процесса:

Просмотр галлереи продуктов (Page)
Просмотр детальной информации о продукте (CardPreviewModal)
Оформление заказа (BasketModal, OrderModal, ContactsModal, PaymentSuccessModal).

Модальное окно в проекте его логика и структура вынесена в класс Modal. Оно используется для отображения любого передаваемого ему контента. BasketModal, OrderModal, ContactsModal, PaymentSuccessModal, CardPreviewModal отрисовываются внутри модального окна.

## Архитектура проекта (MVP)

Проект построен по шаблону MVP (Model–View–Presenter) — разделена ответственность между слоями:

**Model** — данные и бизнес-логика

**View** — пользовательский интерфейс

**Presenter** — посредник между Model и View

### Слой Model
В проекте реализованы три модели данных: BasketModel, OrderModel, ProductModel.

**ProductModel** представляет собой модель данных, отвечающую за хранение и предоставление списка продуктов. IProduct — интерфейс, описывающий объект продукта, получаемый с бэкенда.
У этой модели есть сеттер и геттер:
setProducts(items: IProduct[]) - сохраняет переданный массив продуктов во внутреннее состояние модели.
getProducts(): IProduct[] - возвращает текущий массив продуктов, хранящийся в модели.

**BasketModel** отвечает за управление состоянием корзины покупок. Он содержит методы добавления, удаления и очистки товаров, а также предоставляет информацию о текущем содержимом корзины и общей стоимости.
У данного класса есть геттеры:
1) на возвращение суммарной стоимости всех товаров в корзине
2) на количество товаров в корзине
3) на текущий список товаров в корзине.

В этом классе есть несколько методов. Метод addProductToBasket(product: IProduct) - добавляет товар в корзину. Метод deleteItem(id: string) - удаляет товар из корзины по его id. Метод clear() очищает корзину, удаляя все товары.

**OrderModel** это хранение и управление информацией, связанной с оформлением заказа (контактные данные пользователя и способ оплаты). Данная модель использует тип IOrder — интерфейс, описывающий структуру заказа. Используется опционально через Partial<IOrder> для поэтапной сборки данных.

Данная модель имеет несколько методов.
Метод setOrderInfo(paymentMethod: string, address: string) устанавливает адрес и способ оплаты. Принимает параметры: paymentMethod — способ оплаты и address — адрес доставки.

Метод setContactInfo(phone: string, email: string) - устанавливает контактные данные пользователя. Принимает параметры: phone — номер телефона и email — адрес электронной почты.

Метод collectInfo(): Partial<IOrder> собирает и возвращает текущую информацию о заказе в виде объекта данных, который будет отправлен на сервер.

Метод clear() - сброс всех данных. Используется после успешного оформления заказа.

### Слой View

Класс Component<T> — абстрактный базовый класс, созданный для работы с DOM элементами: управление классами, отображением, текстами, изображениями и состоянием элементов. Служит основой для всех визуальных компонентов для единого интерфейса и поведения.
Поле protected readonly container: HTMLElement корневой DOM-элемент компонента.

В данном классе есть конструктор и методы.

Метод toggleClass(element: HTMLElement, className: string, force?: boolean) - добавляет или удаляет CSS-класс у элемента.

Метод setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое элемента, преобразует значение в строку.

Метод setDisabled(element: HTMLElement, state: boolean) - устанавливает или убирает атрибут disabled у HTML-элемента.

Метод setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает источник изображения и опционально можно добавить альтернативный текст.

Метод render(data?: Partial<T>): HTMLElement - отрисовывает переданные данные, используя их к текущему экземпляру компонента через Object.assign и возвращает корневой HTML-элемент компонента.

#### Пример реализации класса Modal на основе базового класса Component.
Класс Modal представляет модальное окно интерфейса. Наследуется от базового класса Component<T>, реализуя работу с DOM, и использует интерфейс IModal в качестве аргумента в методе render (содержимое модального окна). Модальное окно управляется через методы open (открытие окна) и close (закрытие окна), а также реагирует на события пользователя (клик по фону для закрытия окна). В связке с внешним EventEmitter уведомляет Presenter о необходимости закрытия модального окна.
В конструктор передается container — корневой DOM-элемент и events — объект-эмиттер событий для взаимодействия с Presenter. Конструктор инициализирует элементы, назначает обработчик закрытия по кнопке и по клику вне модального окна. Также конструктор использует метод ensureElement (метод из файла utils, содержащего функции и типы общего использования) — для получения DOM-элемента.

У данного класса есть сеттер set content(value: HTMLElement) - который обновляет содержимое модального окна.

Метод open() - открывает модальное окно, добавляя CSS-класс active.
Метод close() - закрывает модальное окно, удаляя CSS-класс active.
Внутри класса используются методы класса Component (toggleClass, render).

#### Пример реализации класса BasketModal на основе базового класса Component.
BasketModal — UI-компонент, показывающий содержимое корзины в модальном окне. Управляет списком товаров, отображением итоговой суммы и кнопкой оформления заказа. Наследует от абстрактного Component, получая доступ к методам работы с DOM, и принимает в качестве аргумента метода render интерфейс IBasketModal, данные для отрисовки в окне.

Работает в связке с Presenter, обмениваясь событиями через EventEmitter. В конструкторе получает ссылки на productContainer — список товаров (```<ul>```), orderButton — кнопка «Оформить», totalPriceElement — элемент показывающий общую стоимость. Вешает обработчик события на orderButton, при клике метод emit обьекта Events уведомляет о событии orderStart.

BasketModal использует сеттеры.
Set products устанавливает список товаров в корзине. Если массив не пустой - обновляет содержимое productContainer и активирует кнопку заказа. Если массив пустой - блокирует кнопку заказа и показывает сообщение что корзина пуста.
Set totalPrice обновляет показ итоговой суммы на основе переданного значения. Значение форматируется в строку.
Внутри класса используются методы класса Component (setText, toggleClass, render).

### API
В рамках проекта используется общий класс API и два отдельных класса ApiProduct, ApiOrder  отвечающие за взаимодействие с определенной областью.
**ApiProduct** — отвечает за получение данных о товарах. Использует метод get для получения списка продуктов с сервера.
**ApiOrder** — обрабатывает заказы и работает с данными пользователя для отправки на сервер. Отправляет данные на сервер через POST-запрос.
Оба класса принимают в конструкторе экземпляр базового класса Api, который содержит общую логику HTTP-запросов. При необходимости можно добавить новые классы, не затрагивая существующую логику.
